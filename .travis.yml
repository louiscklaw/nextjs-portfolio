#.travis.yml
sudo: false

dist: bionic

language: node_js

node_js:
  - 8

install:
  - cd $TRAVIS_BUILD_DIR
  - yarn install

script:
  - cd $TRAVIS_BUILD_DIR
  - yarn test

before_deploy:
  - cd $TRAVIS_BUILD_DIR
  - yarn predeploy
  - npm install -g firebase-tools firebase-functions firebase-admin

deploy:
  # staging deploy
  - provider: script
    skip_cleanup: true
    script: bash scripts/deploy_staging.sh

    on:
      all_branches: true
      condition: $TRAVIS_BRANCH = "develop"

  # production deploy
  - provider: script
    skip_cleanup: true
    script: bash scripts/deploy_production.sh

    on:
      all_branches: true
      condition: $TRAVIS_BRANCH = "master"

cache:
    npm: true
    directories:
        - node_modules


after_success:
  - cd $TRAVIS_BUILD_DIR/_ref/travis-build-merger
  - id
  - sudo apt update
  - sudo apt install -y python3 python3-pip python3-dev python3-wheel python3-setuptools
  - pip3 install --user pipenv
  - pipenv sync
  - pipenv run python3 travis-build-merger.py

notifications:
  slack: louislabs:x4D51HjnR30LGpqZXrdbqUgB
